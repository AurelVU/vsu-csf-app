# Документация по проекту CSF App

## Содержание

- [Авторизация](#авторизация)
- [Генерация модулей](#генерация-модулей)
- [Навигация](#навигация)
- [Структура проекта](#структура-проекта)
- [Конфиденциальные файлы](#конфиденциальные-файлы)
- [Известные проблемы](#известные-проблемы)

## Авторизация

В приложении используется система авторизации с разделением ролей на студентов и преподавателей.

### SharedPreference

- `appType` - строковое поле, которое может иметь значение:
  - `'student'` - пользователь авторизован как студент
  - `'teacher'` - пользователь авторизован как преподаватель
  - `''` (пустая строка) - пользователь не авторизован

## Генерация модулей

Для ускорения разработки используется скрипт генерации модулей.

### Скрипт `generate_module`

Скрипт автоматически создаёт структуру модуля со всеми необходимыми презентерами, сервисами и представлениями.

**Пример использования:**

```bash
./generate_module.sh code ./lib/feature/common/auth/
```

Эта команда создаст в папке `auth` новую директорию `code` со всеми необходимыми файлами. Если требуется только представление с презентером, данные из папки `data` можно удалить.

**Примечание:** Скрипт имеет некоторые недочёты, и иногда может потребоваться добавить недостающие импорты вручную.

## Навигация

### Роутеры

В проекте используются два основных роутера:

- `student_router` - для навигации в режиме студента
- `teacher_router` - для навигации в режиме преподавателя

Данные роутеры находятся в пределах единой навигации и разделены для удобства разработки.

### Начальная навигация

- Начальная страница определяется на основе значения `appType` в SharedPreference
- При выходе из аккаунта или его удалении текущий `HomeRoute` заменяется на `AuthRoute`
- При инициализации начальных страниц отображается анимированный сплэш-скрин
  - Параметр `playAnimation` у начальных роутов указывает, нужно ли проигрывать анимацию перед показом страницы
  - Анимация используется для улучшения пользовательского опыта при загрузке

**Возможная проблема:** При истечении срока действия refresh-токена, но при наличии установленного `appType`, пользователь может увидеть пустые экраны без информации. Необходимо провести дополнительное тестирование и найти решение данной проблемы.

## Структура проекта

### Организация папок

- `feature/` - основные функциональные модули
  - `student/` - функциональность для студентов
  - `teacher/` - функциональность для преподавателей
  - `common/` - общие компоненты и функции

В фичах присутствует прослойка в виде репозиториев, нужная из-за частых изменений в API бэкенда. DTO-объекты расположены непосредственно в фичах.

## Конфиденциальные файлы

В проекте используются различные конфиденциальные файлы, которые **не должны** добавляться в систему контроля версий. Эти файлы необходимо добавить в проект локально.

### Файл с секретными ключами API

1. **Секретные ключи API**
   - Файл: `lib/config/app_secrets.dart`
   - Пример: `lib/config/app_secrets.example.dart`
   - Содержание: API ключи для сервисов AppMetrica, OneSignal и других
   - Процесс настройки:
     - Скопировать `app_secrets.example.dart` в `app_secrets.dart`
     - Заполнить реальными значениями полученными из соответствующих сервисов
   - Размещение: Поместить в папку `lib/config/`

### Firebase конфигурация

1. **Google Services JSON (Android)**
   - Файл: `android/app/google-services.json`
   - Получение: Из Firebase Console -> Проект -> Настройки проекта -> Приложения -> Android -> Скачать google-services.json
   - Размещение: Поместить в папку `android/app/`

2. **Firebase Options (Dart)**
   - Файл: `lib/firebase_options.dart`
   - Получение: Генерируется автоматически при инициализации Firebase с помощью FlutterFire CLI
   - Команда: `flutterfire configure`
   - Размещение: Поместить в папку `lib/`

3. **Firebase App ID (iOS)**
   - Файл: `ios/firebase_app_id_file.json`
   - Получение: Генерируется автоматически при инициализации Firebase с помощью FlutterFire CLI
   - Размещение: Поместить в папку `ios/`

### Ключи для подписи приложения (Android)

1. **Файл настроек ключа**
   - Файл: `android/key.properties`
   - Содержание:

     ```
     storePassword=<пароль хранилища>
     keyPassword=<пароль ключа>
     keyAlias=<алиас ключа>
     storeFile=<относительный путь к JKS файлу>
     ```

   - Размещение: Поместить в папку `android/`

2. **Файл хранилища ключей**
   - Файл: `android/keystore-vsu.jks` (или аналогичный файл .jks)
   - Получение: Создается с помощью keytool
   - Размещение: Поместить в папку `android/`

### Локальные настройки

1. **Android Local Properties**
   - Файл: `android/local.properties`
   - Содержание: Автоматически генерируется Android Studio или Flutter SDK
   - Размещение: Поместить в папку `android/`

**ВАЖНО:** Эти файлы содержат чувствительные данные (API ключи, пароли и т.д.) и не должны быть доступны публично. Обеспечьте их безопасное хранение и передачу между членами команды разработки.

## Известные проблемы

1. **AllNewsScreen**: реализован через один общий презентер, в котором подменяются запросы и scroll-контроллеры в зависимости от типа. Рекомендуется переработать в отдельный экран с использованием `@factory` менеджера.

2. **Интерфейсы**: большое количество интерфейсов создаёт избыточную сложность. Рекомендуется пересмотреть архитектуру и, возможно, избавиться от некоторых интерфейсов.
